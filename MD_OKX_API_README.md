# Настройка OKX API для реальной торговли

## Получение API ключей

1. Зарегистрируйтесь на бирже OKX (https://www.okx.com)
2. Пройдите верификацию KYC
3. Перейдите в раздел API управления:
    - Войдите в аккаунт
    - Перейдите в "Account" → "API"
    - Нажмите "Create API Key"

## Создание API ключа

1. **Настройки API:**
    - Название: `StatArbitrage Trading Bot`
    - Права доступа: `Trade` (для торговли)
    - IP разрешения: укажите IP вашего сервера (или оставьте пустым для тестирования)
    - Passphrase: придумайте надежную парольную фразу

2. **Получите следующие данные:**
    - API Key
    - Secret Key
    - Passphrase

## Настройка в приложении

Откройте файл `src/main/resources/application.properties` и заполните:

```properties
# OKX API Configuration
okx.api.key=YOUR_API_KEY_HERE
okx.api.secret=YOUR_SECRET_KEY_HERE
okx.api.passphrase=YOUR_PASSPHRASE_HERE
okx.api.sandbox=true  # true для тестирования, false для реальной торговли
```

## Безопасность

⚠️ **ВАЖНО:**

- Никогда не публикуйте ваши API ключи в открытом виде
- Используйте переменные окружения для продакшена
- Установите ограничения по IP для API ключей
- Регулярно ротируйте ключи

### Использование переменных окружения

Для продакшена рекомендуется использовать переменные окружения:

```bash
export OKX_API_KEY="your_api_key"
export OKX_API_SECRET="your_secret_key"
export OKX_API_PASSPHRASE="your_passphrase"
export OKX_API_SANDBOX="false"
```

И в application.properties:

```properties
okx.api.key=${OKX_API_KEY:}
okx.api.secret=${OKX_API_SECRET:}
okx.api.passphrase=${OKX_API_PASSPHRASE:}
okx.api.sandbox=${OKX_API_SANDBOX:true}
```

## Тестирование

1. **Запуск с тестовыми ключами:**
    - Установите `okx.api.sandbox=true`
    - Запустите приложение
    - Перейдите в веб-интерфейс
    - Выберите режим "OKX API" в разделе портфолио

2. **Проверка подключения:**
    - Приложение автоматически проверит подключение к OKX API
    - В логах появится сообщение о статусе подключения
    - Если ключи настроены правильно, вы увидите реальный баланс

## Переключение на реальную торговлю

⚠️ **ТОЛЬКО ДЛЯ ОПЫТНЫХ ПОЛЬЗОВАТЕЛЕЙ:**

1. Убедитесь, что все настройки корректны
2. Протестируйте на минимальных суммах
3. Установите `okx.api.sandbox=false`
4. Перезапустите приложение

## Поддерживаемые операции

- ✅ Получение баланса аккаунта
- ✅ Открытие LONG позиций
- ✅ Открытие SHORT позиций
- ✅ Закрытие позиций
- ✅ Получение текущих цен
- ✅ Синхронизация позиций с биржей
- ✅ Расчет комиссий

## Лимиты API

- Скорость запросов: ограничено OKX API
- Минимальный размер ордера: зависит от торговой пары
- Доступные инструменты: фьючерсы USDT

## Устранение неполадок

**Ошибка аутентификации:**

- Проверьте правильность API ключей
- Убедитесь, что время на сервере синхронизировано
- Проверьте права доступа API ключа

**Ошибки торговли:**

- Убедитесь, что у вас достаточно средств
- Проверьте, что торговая пара поддерживается
- Убедитесь, что размер ордера соответствует минимальным требованиям

**Проблемы с подключением:**

- Проверьте интернет соединение
- Убедитесь, что IP не заблокирован
- Проверьте настройки файрвола

## Техническая информация

- **Базовый URL (продакшен):** https://www.okx.com
- **Используемые эндпоинты:**
    - `/api/v5/trade/order` - создание ордеров
    - `/api/v5/account/balance` - получение баланса
    - `/api/v5/account/positions` - получение позиций
    - `/api/v5/market/ticker` - получение цен
- **Тип ордеров:** Market (рыночные)
- **Режим торговли:** Isolated margin (изолированная маржа)
- **Комиссии:** 0.05% для taker ордеров