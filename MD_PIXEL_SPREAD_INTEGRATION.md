# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–∏–∫—Å–µ–ª—å–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É —Å–∫–æ—Ä–∏–Ω–≥–∞

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ PixelSpreadService

#### `calculateAveragePixelSpreadFromCandles()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–∏–∫—Å–µ–ª—å–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞ –±–µ–∑ PairData
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 
  - `List<Candle> longCandles` - —Å–≤–µ—á–∏ –¥–ª—è long —Ç–∏–∫–µ—Ä–∞
  - `List<Candle> shortCandles` - —Å–≤–µ—á–∏ –¥–ª—è short —Ç–∏–∫–µ—Ä–∞  
  - `String longTicker`, `String shortTicker` - –∏–º–µ–Ω–∞ —Ç–∏–∫–µ—Ä–æ–≤ –¥–ª—è –ª–æ–≥–æ–≤
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å–≤–µ—á–µ–π, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ü–µ–Ω—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω Z-Score, –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Ä

#### `calculateCurrentPixelSpreadFromCandles()`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–∏–∫—Å–µ–ª—å–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞ (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –¢–µ –∂–µ, —á—Ç–æ –∏ —É –ø–æ–ª–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–≤–µ—á–µ–π –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞, –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ç–µ–∫—É—â–∏–º —Ü–µ–Ω–∞–º
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ getBestZScoreData() –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º—É —Å–∫–æ—Ä–∏–Ω–≥–∞

#### –û–±–Ω–æ–≤–ª–µ–Ω `ObtainTopZScoreDataBeforeCreateNewPairService`

**–ù–æ–≤–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```java
public Optional<ZScoreData> getBestZScoreData(Settings settings, List<ZScoreData> dataList, Map<String, List<Candle>> candlesMap)
```

**–û–±–Ω–æ–≤–ª–µ–Ω `calculatePixelSpreadScoreComponent()`**:
1. **–°–Ω–∞—á–∞–ª–∞** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é PairData (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
2. **–ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö** - –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –∏–∑ candlesMap —Å –ø–æ–º–æ—â—å—é `calculateCurrentPixelSpreadFromCandles()`
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç—É –∂–µ —Å–∏—Å—Ç–µ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤:
   - < 20px: 0% –æ—Ç –≤–µ—Å–∞
   - 20-40px: 25-50% –æ—Ç –≤–µ—Å–∞  
   - 40-80px: 50-75% –æ—Ç –≤–µ—Å–∞
   - 80+ px: 75-100% –æ—Ç –≤–µ—Å–∞

### 3. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### `ZScoreService.obtainTopNZScoreData()`
–û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ candlesMap:
```java
Optional<ZScoreData> maybeBest = obtainTopZScoreDataBeforeCreateNewPairService
    .getBestZScoreData(settings, remainingPairs, candlesMap);
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ getBestZScoreData():

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä** - –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
2. **–î–ª—è –∫–∞–∂–¥–æ–π –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞—Ä—ã**:
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `calculatePairQualityScore()` —Å candlesMap
   - **–ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**:
     - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ PairData ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getAveragePixelSpread()` 
     - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `calculateCurrentPixelSpreadFromCandles()`
     - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–æ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
3. **–í—ã–±–æ—Ä –ª—É—á—à–µ–π –ø–∞—Ä—ã** –ø–æ –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ–º—É —Å–∫–æ—Ä—É

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
üìè –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø–∞—Ä–∞): avg=45.3px ‚Üí 15.2 –±–∞–ª–ª–æ–≤
üìè –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ (–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—É—â–∏–π): 62.1px ‚Üí 18.7 –±–∞–ª–ª–æ–≤
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ë—ã—Å—Ç—Ä—ã–π –º–µ—Ç–æ–¥** –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å–≤–µ—á–µ–π vs 200 –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **–û–¥–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ** vs —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ –≤–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
- **–ò–¥–µ–∞–ª—å–Ω–æ** –¥–ª—è —Å–∫–æ—Ä–∏–Ω–≥–∞, –≥–¥–µ –≤–∞–∂–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞, –∞ –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `settings.isUsePixelSpreadScoring()` - –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å 
- `settings.getPixelSpreadScoringWeight()` - –≤–µ—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 25)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ª—É—á—à–µ–π –ø–∞—Ä—ã **–î–û** —Å–æ–∑–¥–∞–Ω–∏—è PairData —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç:
1. ‚úÖ –û—Ü–µ–Ω–∏–≤–∞—Ç—å –ø–∏–∫—Å–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –Ω–æ–≤—ã—Ö –ø–∞—Ä –∏–∑ candlesMap
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Ä 
3. ‚úÖ –î–∞–≤–∞—Ç—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—É—é –æ—Ü–µ–Ω–∫—É –≤—Å–µ–º –ø–∞—Ä–∞–º
4. ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É