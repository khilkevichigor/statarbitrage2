# Улучшения обработки ошибок переключения режимов торговли

## Что было улучшено

### 1. Детальная информация об ошибках

- **Раньше**: Общее сообщение "Не удалось переключиться на: [режим]"
- **Теперь**: Конкретные сообщения с объяснением проблемы и рекомендациями

### 2. Различные типы ошибок

- `PROVIDER_NOT_IMPLEMENTED` - провайдер не реализован
- `CONFIGURATION_MISSING` - отсутствует конфигурация (API ключи)
- `CONNECTION_ERROR` - ошибка подключения к API
- `INVALID_CREDENTIALS` - неверные учетные данные
- `INTERNAL_ERROR` - внутренняя ошибка системы

### 3. Адаптивные уведомления

- Разная длительность показа в зависимости от важности ошибки
- Цветовая индикация (красный для ошибок, зеленый для успеха)
- Рекомендации по устранению проблем

## Как протестировать

### Тест 1: Отсутствие API ключей (текущая проблема)

1. Запустите приложение
2. Перейдите в раздел Портфолио
3. Попробуйте переключиться на "OKX API"
4. **Ожидаемый результат**:
    - Красное уведомление: "Для использования OKX API необходимо настроить ключи доступа"
    - Рекомендация: "Добавьте API ключи в application.properties: okx.api.key, okx.api.secret, okx.api.passphrase"
    - Длительность: 7 секунд
    - ComboBox вернется к предыдущему значению

### Тест 2: Нереализованный провайдер

1. Попробуйте переключиться на "3Commas API"
2. **Ожидаемый результат**:
    - Красное уведомление: "Режим 3Commas API пока не доступен"
    - Рекомендация: "Используйте виртуальную торговлю или OKX API"
    - Длительность: 3 секунды

### Тест 3: Успешное переключение

1. Переключитесь на "Виртуальная торговля"
2. **Ожидаемый результат**:
    - Зеленое уведомление: "✅ Режим торговли успешно изменен на: Виртуальная торговля"
    - Обновление информации о портфолио

### Тест 4: С настроенными API ключами

1. Добавьте тестовые API ключи в `application.properties`:
   ```properties
   okx.api.key=test_key
   okx.api.secret=test_secret
   okx.api.passphrase=test_passphrase
   ```
2. Попробуйте переключиться на "OKX API"
3. **Ожидаемый результат**:
    - Если ключи неверные: "Не удалось подключиться к OKX API"
    - Если ключи правильные: "✅ Режим торговли успешно изменен на: OKX API"

## Структура новых классов

### TradingProviderSwitchResult

```java
public class TradingProviderSwitchResult {
    private boolean success;
    private SwitchErrorType errorType;
    private String errorMessage;
    private String userMessage;
    private String recommendation;

    public enum SwitchErrorType {
        PROVIDER_NOT_IMPLEMENTED,
        CONFIGURATION_MISSING,
        CONNECTION_ERROR,
        INVALID_CREDENTIALS,
        INTERNAL_ERROR
    }
}
```

### Новые методы

- `TradingProviderFactory.switchToProviderWithDetails()`
- `TradingIntegrationService.switchTradingModeWithDetails()`
- `PortfolioComponent.handleTradingModeSwitch()`
- `PortfolioComponent.handleSwitchError()`
- `PortfolioComponent.createErrorNotification()`

## Логирование

Теперь все события переключения режимов логируются:

- Успешные переключения: `INFO` уровень
- Ошибки переключения: `ERROR` уровень
- Детали ошибок: тип ошибки, сообщение, рекомендации

## Совместимость

Старые методы (`switchTradingMode()`) сохранены для обратной совместимости, но рекомендуется использовать новые методы с детальной информацией.

## Следующие шаги

1. Протестируйте все сценарии
2. Добавьте реальные API ключи для тестирования OKX
3. При необходимости настройте дополнительные типы ошибок
4. Рассмотрите возможность добавления аналогичной логики для других операций