# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FetchPairsProcessor –¥–ª—è MacOS M1

## –ü—Ä–æ–±–ª–µ–º–∞
OKX API –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ 8 –ø–æ—Ç–æ–∫–æ–≤ –ø–æ–ª—É—á–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏:
```
NullPointerException: Cannot invoke "com.google.gson.JsonArray.iterator()" because "rawCandles" is null
```

## –†–µ—à–µ–Ω–∏–µ: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏ 5 –ø–æ—Ç–æ–∫–∞—Ö

### 1. Rate Limiting
- **MIN_REQUEST_INTERVAL_MS**: 120–º—Å –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (8.3 RPS)
- **–£–º–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: `applyRateLimit()` –≤ –º–µ—Ç–æ–¥–µ `getCandles()`
- **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É API

### 2. Batch Processing
- **BATCH_SIZE**: 50 —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ —Ä–∞–∑
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π**: –£–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API
- **–ü–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏**: 200–º—Å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **Graceful degradation**: –í–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ –≤–º–µ—Å—Ç–æ null
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ä–∞—Ö
- **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**: –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞

### 4. HTTP Client –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **Connection Pool**: 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, 5 –º–∏–Ω—É—Ç keep-alive
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**: connect=10—Å, read=30—Å, write=10—Å
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**

### 5. Thread Safety
- **Synchronized –∫–æ–ª–ª–µ–∫—Ü–∏–∏**: `Collections.synchronizedMap()` –∏ `Collections.synchronizedList()`
- **Explicit synchronization**: `synchronized` –±–ª–æ–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π
- **Final –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: –î–ª—è lambda expressions

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**: –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏
- **Batch progress**: –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –±–∞—Ç—á–∞–º "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á 1/5"
- **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ë—ã–ª–æ (—Å 8 –ø–æ—Ç–æ–∫–∞–º–∏):
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ OKX API
- ‚ùå NullPointerException
- ‚ùå –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

### –°—Ç–∞–ª–æ (—Å 5 –ø–æ—Ç–æ–∫–∞–º–∏ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ Batch processing –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ Graceful error handling
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **Throughput**: ~8.3 RPS (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è OKX)
- **Batch size**: 50 —Å–∏–º–≤–æ–ª–æ–≤ = —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤
- **Connection reuse**: –£–º–µ–Ω—å—à–µ–Ω–∏–µ overhead TCP handshake
- **Parallel processing**: 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –õ–æ–≥–∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```
üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–∏–∫–µ—Ä–æ–≤ –≤ 5 –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è 247 —Ç–∏–∫–µ—Ä–æ–≤ (–±–∞—Ç—á–∞–º–∏ –ø–æ 50)
üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º 5 –±–∞—Ç—á–µ–π –ø–æ 50 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
üîÑ –í–∞–ª–∏–¥–∏—Ä—É–µ–º –±–∞—Ç—á 1/5 (50 —Å–∏–º–≤–æ–ª–æ–≤)
üîÑ –í–∞–ª–∏–¥–∏—Ä—É–µ–º –±–∞—Ç—á 2/5 (50 —Å–∏–º–≤–æ–ª–æ–≤)
...
‚úÖ –í—Å–µ–≥–æ –æ—Ç–æ–±—Ä–∞–Ω–æ 150 —Ç–∏–∫–µ—Ä–æ–≤ –≤ 5 –ø–æ—Ç–æ–∫–æ–≤ –∑–∞ 45.67—Å
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Rate Limiting Algorithm:
```java
private void applyRateLimit() {
    long now = System.currentTimeMillis();
    long timeSinceLastRequest = now - lastRequestTime.get();
    
    if (timeSinceLastRequest < MIN_REQUEST_INTERVAL_MS) {
        long sleepTime = MIN_REQUEST_INTERVAL_MS - timeSinceLastRequest;
        Thread.sleep(sleepTime);
    }
    
    lastRequestTime.set(System.currentTimeMillis());
}
```

### Batch Processing Strategy:
- –†–∞–∑–±–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ä–æ–≤ –Ω–∞ –±–∞—Ç—á–∏ –ø–æ 50 —à—Ç—É–∫
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –±–∞—Ç—á –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ 5 –ø–æ—Ç–æ–∫–æ–≤
- –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∞—Ç—á–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
- 200–º—Å –ø–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

–≠—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å OKX API –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ MacOS M1.